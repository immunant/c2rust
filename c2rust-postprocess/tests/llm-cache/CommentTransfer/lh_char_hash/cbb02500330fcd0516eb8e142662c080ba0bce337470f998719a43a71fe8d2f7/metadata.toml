transform = "CommentTransfer"
identifier = "lh_char_hash"
model = "gemini-3-flash-preview"
response = """```rust
unsafe extern "C" fn lh_char_hash(mut k: *const ::core::ffi::c_void) -> ::core::ffi::c_ulong {
    static mut random_seed: ::core::ffi::c_int = -(1 as ::core::ffi::c_int);
    if random_seed == -(1 as ::core::ffi::c_int) {
        let mut seed: ::core::ffi::c_int = 0;
        /* we can't use -1 as it is the unitialized sentinel */
        loop {
            seed = json_c_get_random_seed();
            if !(seed == -(1 as ::core::ffi::c_int)) {
                break;
            }
        }
        //#warning "racy random seed initializtion if used by multiple threads"
        ::core::intrinsics::atomic_cxchg_seqcst_seqcst(
            &raw mut random_seed,
            -(1 as ::core::ffi::c_int),
            seed,
        )
        .0; /* potentially racy */
    }
    return hashlittle(
        k as *const ::core::ffi::c_char as *const ::core::ffi::c_void,
        strlen(k as *const ::core::ffi::c_char),
        random_seed as uint32_t,
    ) as ::core::ffi::c_ulong;
}
```"""

[[messages]]
role = "user"
content = """Transfer the comments from the following C function to the corresponding Rust function.
Do not add any comments that are not present in the C function.
Use Rust doc comment syntax (///) where appropriate (e.g., for function documentation).
Respond with the Rust function definition with the transferred comments; say nothing else.

C function:
```c
static unsigned long lh_char_hash(const void *k)
{
#if defined _MSC_VER || defined __MINGW32__
#define RANDOM_SEED_TYPE LONG
#else
#define RANDOM_SEED_TYPE int
#endif
\tstatic volatile RANDOM_SEED_TYPE random_seed = -1;

\tif (random_seed == -1) {
\t\tRANDOM_SEED_TYPE seed;
\t\t/* we can't use -1 as it is the unitialized sentinel */
\t\twhile ((seed = json_c_get_random_seed()) == -1);
#if SIZEOF_INT == 8 && defined __GCC_HAVE_SYNC_COMPARE_AND_SWAP_8
#define USE_SYNC_COMPARE_AND_SWAP 1
#endif
#if SIZEOF_INT == 4 && defined __GCC_HAVE_SYNC_COMPARE_AND_SWAP_4
#define USE_SYNC_COMPARE_AND_SWAP 1
#endif
#if SIZEOF_INT == 2 && defined __GCC_HAVE_SYNC_COMPARE_AND_SWAP_2
#define USE_SYNC_COMPARE_AND_SWAP 1
#endif
#if defined USE_SYNC_COMPARE_AND_SWAP
\t\t(void)__sync_val_compare_and_swap(&random_seed, -1, seed);
#elif defined _MSC_VER || defined __MINGW32__
\t\tInterlockedCompareExchange(&random_seed, seed, -1);
#else
//#warning "racy random seed initializtion if used by multiple threads"
\t\trandom_seed = seed; /* potentially racy */
#endif
\t}

\treturn hashlittle((const char*)k, strlen((const char*)k), random_seed);
}```

Rust function:
```rust
unsafe extern "C" fn lh_char_hash(mut k: *const ::core::ffi::c_void) -> ::core::ffi::c_ulong {
    static mut random_seed: ::core::ffi::c_int = -(1 as ::core::ffi::c_int);
    if random_seed == -(1 as ::core::ffi::c_int) {
        let mut seed: ::core::ffi::c_int = 0;
        loop {
            seed = json_c_get_random_seed();
            if !(seed == -(1 as ::core::ffi::c_int)) {
                break;
            }
        }
        ::core::intrinsics::atomic_cxchg_seqcst_seqcst(
            &raw mut random_seed,
            -(1 as ::core::ffi::c_int),
            seed,
        )
        .0;
    }
    return hashlittle(
        k as *const ::core::ffi::c_char as *const ::core::ffi::c_void,
        strlen(k as *const ::core::ffi::c_char),
        random_seed as uint32_t,
    ) as ::core::ffi::c_ulong;
}```
"""
